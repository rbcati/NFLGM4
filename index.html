<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NFL GM Simulator</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <header class="topbar" role="navigation">
        <div class="brand">NFL GM</div>
        <nav id="site-nav" class="nav-pills" aria-label="Primary">
            <a href="#/hub" class="nav-pill" data-view="hub">Home</a>
            <a href="#/roster" class="nav-pill" data-view="roster">Roster</a>
            <a href="#/trade" class="nav-pill" data-view="trade">Trades</a>
            <a href="#/standings" class="nav-pill" data-view="standings">Standings</a>
            <a href="#/freeagency" class="nav-pill" data-view="freeagency">Free Agency</a>
            <a href="#/draft" class="nav-pill" data-view="draft">Draft</a>
            <a href="#/scouting" class="nav-pill" data-view="scouting">Scouting</a>
            <a href="#/settings" class="nav-pill" data-view="settings">Settings</a>
            <a href="#/hallOfFame" class="nav-pill" data-view="hallOfFame">Hall of Fame</a>
        </nav>
        <button class="nav-toggle" aria-expanded="false" aria-controls="site-nav" aria-label="Toggle menu">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
    </header>

    <main class="layout">
        <aside class="sidebar">
            <div class="section">
                <label for="userTeam">Your Team</label>
                <select id="userTeam"></select>
            </div>
            <div class="section">
              <div>Season <span id="seasonNow"></span></div>
              <div>Cap Used: <span id="capUsed"></span> / <span id="capTotal"></span></div>
              <div class="muted small">Dead Cap: <span id="deadCap"></span></div>
              <div class="muted small">Room: <span id="capRoom"></span></div>
            </div>
            <div class="section">
                <button id="btnSave" class="btn">Save</button>
                <button id="btnLoad" class="btn">Load</button>
                <button id="btnNewLeague" class="btn danger">New League</button>
            </div>
            <div id="statusMsg" class="section muted"></div>
        </aside>

        <section class="content">
            <section id="hub" class="view">
              <div class="card">
                <div class="row"><h2>League Hub</h2><div class="spacer"></div><div class="muted">Season <span id="hubSeason"></span></div></div>
                <div class="grid two">
                  <div>
                    <div>Week <span id="hubWeek"></span> of <span id="hubWeeks"></span></div>
                    <div>Games this week: <span id="hubGames"></span></div>
                    <div class="actions mt"><button id="btnSimWeek" class="btn primary">Simulate Week</button></div>
                  </div>
                  <div><h3>Power Ranking</h3><ol id="hubPower"></ol></div>
                </div>
              </div>
              <div class="card"><h3>Last Week Results</h3><div id="hubResults" class="list"></div></div>
            </section>
            
            <section id="roster" class="view" hidden>
              <div class="card">
                <div class="row"><h2 id="rosterTitle">Roster</h2><div class="spacer"></div><label for="rosterTeam">Team</label><select id="rosterTeam"></select></div>
                <table class="table" id="rosterTable"></table>
                <div class="row mt">
                  <button id="btnRelease" class="btn danger">Release Selected</button>
                </div>
              </div>
            </section>
            
            <section id="standings" class="view" hidden>
                <div class="card">
                    <h2>Standings</h2>
                    <div id="standingsWrap"></div>
                </div>
            </section>
            
            <section id="scouting" class="view" hidden>
                <div class="card">
                    <h2>Upcoming Draft Class (<span id="draftYear"></span>)</h2>
                    <div id="scoutingList" class="scouting-grid"></div>
                </div>
            </section>
            
            <section id="hallOfFame" class="view" hidden>
                <div class="card">
                    <h2>Hall of Fame</h2>
                    <div id="hofList" class="hof-grid"></div>
                </div>
            </section>
            
            <section id="trade" class="view" hidden>
              <div class="card">
                <h2>Trade Center</h2>
                <div class="grid two">
                  <div>
                    <label for="tradeA">Team A</label>
                    <select id="tradeA"></select>
                    <div id="tradeListA" class="list"></div>
                    <div id="pickListA" class="list"></div>
                  </div>
                  <div>
                    <label for="tradeB">Team B</label>
                    <select id="tradeB"></select>
                    <div id="tradeListB" class="list"></div>
                    <div id="pickListB" class="list"></div>
                  </div>
                </div>
                <div class="row mt">
                  <button id="tradeValidate" class="btn">Validate</button>
                  <div id="tradeInfo" class="spacer"></div>
                  <button id="tradeExecute" class="btn primary" disabled>Execute</button>
                </div>
              </div>
            </section>
            
            <section id="freeagency" class="view" hidden>
                <div class="card">
                  <div class="row"><h2>Free Agency</h2><div class="spacer"></div><label for="faTeam">Sign to</label><select id="faTeam"></select></div>
                  <table class="table" id="faTable"></table>
                  <div class="row mt">
                    <button id="btnSignFA" class="btn primary" disabled>Sign Selected Player</button>
                  </div>
                </div>
            </section>

            <section id="draft" class="view" hidden>
                <div class="card">
                    <h2>Draft</h2>
                    <div class="row">
                        <label for="draftTeam">Team</label>
                        <select id="draftTeam"></select>
                    </div>
                    <div id="draftPicks" class="draft-picks-grid"></div>
                </div>
            </section>

            <section id="settings" class="view" hidden>
                <div class="card">
                    <h2>Settings</h2>
                    <div class="section">
                        <label for="settingsYear">Season Year</label>
                        <input type="number" id="settingsYear" min="1930" max="9999">
                    </div>
                </div>
            </section>
        </section>
    </main>

    <div id="onboardModal" class="modal" hidden>
      <div class="modal-card">
        <h3>Start New League</h3>
        <div class="section">
          <label>Team Names</label>
          <div class="row">
            <label><input type="radio" name="namesMode" value="fictional" checked> Fictional</label>
            <label><input type="radio" name="namesMode" value="real"> Real NFL</label>
          </div>
        </div>
        <div class="section">
          <label>Game Mode</label>
          <div class="row">
            <label><input type="radio" name="gameMode" value="gm" checked> GM Mode</label>
            <label><input type="radio" name="gameMode" value="career"> Career Mode</label>
          </div>
        </div>
        <div id="careerOptions" class="section" hidden>
          <label for="careerRole">Your Role</label>
          <select id="careerRole">
            <option value="GM">General Manager</option>
            <option value="OC">Offensive Coordinator</option>
            <option value="DC">Defensive Coordinator</option>
          </select>
        </div>
        <div class="section">
          <label for="onboardTeam">Choose your team</label>
          <div class="row">
            <select id="onboardTeam"></select>
            <button id="onboardRandom" class="btn">Random</button>
          </div>
        </div>
        <div class="section">
          <button id="onboardStart" class="btn primary">Start Season</button>
        </div>
      </div>
    </div>

<script src="constants.js"></script>
    <script src="state.js"></script>
    <script src="teams.js"></script>
    <script src="utils.js"></script>
    
    <script src="player.js"></script> 
    <script src="staff.js"></script>
    <script src="rookies.js"></script>
    <script src="cap.js"></script>
    <script src="picks.js"></script>
    <script src="schedule.js"></script>
    <script src="league.js"></script>
    
    <script src="simulation.js"></script>
    <script src="playoffs.js"></script>
    <script src="trade.js"></script>
    <script src="freeAgency.js"></script>
    <script src="draft.js"></script>
    <script src="training.js"></script>
    <script src="offseason.js"></script>

    <script src="coaching.js"></script>
    
    <script src="ui.js"></script>
    <script src="events.js"></script>
    <script src="main.js"></script>
    
</body>
</html>
    
</body>
</html>
 // complete-navigation-fix.js - Add this script LAST in your HTML, after all other scripts
'use strict';

(function() {
  console.log('🧭 Loading FINAL navigation fix...');

  // Wait for everything to be ready
  function waitForReady() {
    return new Promise((resolve) => {
      let attempts = 0;
      const maxAttempts = 50;
      
      const check = () => {
        attempts++;
        const ready = window.Constants && window.Teams && window.Utils && window.state && document.readyState === 'complete';
        
        if (ready) {
          console.log('✅ Everything ready for navigation fix');
          resolve();
        } else if (attempts >= maxAttempts) {
          console.log('⚠️ Timeout waiting for dependencies, proceeding anyway');
          resolve();
        } else {
          setTimeout(check, 100);
        }
      };
      
      check();
    });
  }

  // The ONE TRUE ROUTER - replaces all others
  function createFinalRouter() {
    console.log('🔧 Creating final router...');
    
    window.router = function() {
      const path = location.hash || '#/hub';
      const viewName = path.slice(2);
      
      console.log('🧭 Final router navigating to:', viewName);
      
      // Hide all views
      document.querySelectorAll('.view').forEach(view => {
        view.hidden = true;
        view.style.display = 'none';
      });
      
      // Show target view
      const targetView = document.getElementById(viewName);
      if (targetView) {
        targetView.hidden = false;
        targetView.style.display = 'block';
        console.log('✅ Showing view:', viewName);
      } else {
        console.warn('⚠️ View not found:', viewName, 'showing hub instead');
        const hubView = document.getElementById('hub');
        if (hubView) {
          hubView.hidden = false;
          hubView.style.display = 'block';
        }
      }
      
      // Update nav pills
      document.querySelectorAll('.nav-pill').forEach(pill => {
        const href = pill.getAttribute('href');
        const isActive = href === path;
        
        // Remove old states
        pill.classList.remove('active');
        pill.removeAttribute('aria-current');
        
        // Add active state
        if (isActive) {
          pill.classList.add('active');
          pill.setAttribute('aria-current', 'page');
        }
      });
      
      // Only render if game is ready
      if (!state.league || !state.onboarded) {
        console.log('Game not ready, skipping content rendering');
        return;
      }
      
      // Render content
      setTimeout(() => {
        try {
          switch(viewName) {
            case 'hub':
              if (window.renderHub) window.renderHub();
              break;
            case 'roster':
              if (window.renderRoster) window.renderRoster();
              break;
            case 'standings':
              if (window.renderStandings) window.renderStandings();
              break;
            case 'freeagency':
              if (window.renderFreeAgency) window.renderFreeAgency();
              break;
            case 'draft':
            case 'scouting':
              if (window.renderDraft) window.renderDraft();
              break;
            case 'trade':
              if (window.renderTrade) window.renderTrade();
              break;
            case 'coaching':
              if (window.renderCoachingStats) window.renderCoachingStats();
              break;
            case 'settings':
              renderBasicSettings();
              break;
            default:
              console.log('No renderer for:', viewName);
          }
        } catch (error) {
          console.error('Error rendering view:', viewName, error);
        }
      }, 50);
    };
  }

  // Basic settings renderer
  function renderBasicSettings() {
    const settingsView = document.getElementById('settings');
    if (settingsView) {
      settingsView.innerHTML = `
        <div class="card">
          <h2>Settings</h2>
          <div class="section">
            <label>Current Season</label>
            <p>${state.league?.year || 2025}</p>
          </div>
          <div class="section">
            <label>Game Mode</label>
            <p>${state.gameMode === 'gm' ? 'General Manager' : 'Career Mode'}</p>
          </div>
          <div class="section">
            <label>Your Role</label>
            <p>${state.playerRole || 'GM'}</p>
          </div>
          <div class="section">
            <button onclick="resetGame()" class="btn danger">Reset Game</button>
          </div>
        </div>
      `;
    }
  }

  // Reset game function
  window.resetGame = function() {
    if (confirm('Reset game? All progress will be lost.')) {
      localStorage.clear();
      location.reload();
    }
  };

  // Set up navigation events
  function setupFinalNavigation() {
    console.log('🔧 Setting up final navigation...');
    
    // Remove ALL existing event listeners
    window.removeEventListener('hashchange', window.router);
    
    // Add the ONE TRUE hash change listener
    window.addEventListener('hashchange', window.router);
    
    // Set up click handling
    document.addEventListener('click', function(e) {
      // Handle nav pill clicks
      if (e.target.classList.contains('nav-pill')) {
        e.preventDefault();
        const href = e.target.getAttribute('href');
        
        if (href && href.startsWith('#/')) {
          console.log('🖱️ Nav clicked:', href);
          location.hash = href;
        }
        return;
      }
      
      // Handle any other navigation links
      if (e.target.tagName === 'A' && e.target.getAttribute('href')?.startsWith('#/')) {
        e.preventDefault();
        location.hash = e.target.getAttribute('href');
      }
    });
    
    console.log('✅ Final navigation events set up');
  }

  // Add navigation styles
  function addNavigationStyles() {
    const navCSS = `
      /* Navigation Active States */
      .nav-pill.active,
      .nav-pill[aria-current="page"] {
        background: linear-gradient(135deg, var(--accent, #0A84FF), var(--accent-hover, #409CFF)) !important;
        color: white !important;
        box-shadow: 0 2px 8px rgba(10, 132, 255, 0.3) !important;
      }
      
      .nav-pill {
        transition: all 200ms ease !important;
      }
      
      .nav-pill:hover {
        transform: translateY(-1px) !important;
        background: rgba(255, 255, 255, 0.1) !important;
      }
      
      /* View Management */
      .view {
        display: none !important;
      }
      
      .view:not([hidden]) {
        display: block !important;
      }
      
      /* User team highlighting */
      .user-team {
        background: rgba(10, 132, 255, 0.1) !important;
        border-left: 3px solid var(--accent, #0A84FF) !important;
      }
      
      .user-team td {
        color: var(--text, white) !important;
        font-weight: 600 !important;
      }
    `;
    
    const styleEl = document.createElement('style');
    styleEl.id = 'final-nav-styles';
    styleEl.textContent = navCSS;
    
    // Remove any existing styles with same ID
    const existingStyle = document.getElementById('final-nav-styles');
    if (existingStyle) existingStyle.remove();
    
    document.head.appendChild(styleEl);
  }

  // Initialize everything
  async function initializeFinalNavigation() {
    await waitForReady();
    
    console.log('🚀 Initializing final navigation system...');
    
    // Create the router
    createFinalRouter();
    
    // Add styles
    addNavigationStyles();
    
    // Set up events
    setupFinalNavigation();
    
    // Initial route
    setTimeout(() => {
      console.log('🎯 Running initial route...');
      window.router();
    }, 100);
    
    console.log('✅ Final navigation system initialized!');
    console.log('💡 Try clicking the navigation buttons now');
  }

  // Override initializeUIFixes to use our system
  window.initializeUIFixes = initializeFinalNavigation;

  // Start initialization
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeFinalNavigation);
  } else {
    setTimeout(initializeFinalNavigation, 100);
  }

  // Debug functions
  window.debugNavigation = function() {
    console.log('🔍 Navigation Debug Info');
    console.log('Current hash:', location.hash);
    console.log('Router function exists:', typeof window.router === 'function');
    
    const navPills = document.querySelectorAll('.nav-pill');
    console.log('Nav pills found:', navPills.length);
    navPills.forEach((pill, i) => {
      console.log(`  ${i + 1}. ${pill.textContent} -> ${pill.href}`);
    });
    
    const views = document.querySelectorAll('.view');
    console.log('Views found:', views.length);
    views.forEach((view, i) => {
      const visible = !view.hidden && view.style.display !== 'none';
      console.log(`  ${i + 1}. #${view.id} - Visible: ${visible}`);
    });
    
    console.log('State ready:', !!state.league && !!state.onboarded);
  };

  window.testNavigation = function() {
    console.log('🧪 Testing navigation...');
    const testRoutes = ['#/hub', '#/roster', '#/standings'];
    
    testRoutes.forEach((route, i) => {
      setTimeout(() => {
        console.log(`Testing route: ${route}`);
        location.hash = route;
      }, i * 1000);
    });
  };

  console.log('💡 Final navigation fix loaded');
  console.log('Available commands:');
  console.log('- debugNavigation() - Show debug info');  
  console.log('- testNavigation() - Test route switching');

})();
    
    // Fix 2: Enhanced router
    window.router = function() {
      const path = location.hash || '#/hub';
      const viewName = path.slice(2);
      
      console.log('🧭 Routing to:', viewName);
      
      // Show the view
      window.show(viewName);
      
      // Update navigation
      document.querySelectorAll('.nav-pill').forEach(pill => {
        const href = pill.getAttribute('href');
        const isActive = href === path;
        pill.setAttribute('aria-current', isActive ? 'page' : null);
      });
      
      // Only render if game is ready
      if (!state.league || !state.onboarded) {
        console.log('Game not ready, skipping rendering');
        return;
      }
      
      // Render view content
      setTimeout(() => {
        try {
          switch(viewName) {
            case 'hub':
              renderFixedHub();
              break;
            case 'roster':
              renderFixedRoster();
              break;
            case 'standings':
              renderFixedStandings();
              break;
            case 'freeagency':
              if (window.renderFreeAgency) window.renderFreeAgency();
              break;
            case 'draft':
            case 'scouting':
              renderFixedDraft();
              break;
            case 'trade':
              renderFixedTrade();
              break;
            default:
              console.log('No renderer for:', viewName);
          }
        } catch (error) {
          console.error('Error rendering view:', viewName, error);
        }
      }, 50);
    };
    
    // Fix 3: Working renderHub
    function renderFixedHub() {
      console.log('Rendering fixed hub...');
      
      try {
        const L = state.league;
        if (!L) return;
        
        // Update displays
        const updates = [
          { ids: ['hubSeason', 'seasonNow'], value: L.year || '2025' },
          { ids: ['hubWeek'], value: L.week || '1' },
          { ids: ['hubWeeks'], value: L.schedule?.weeks?.length || 18 }
        ];
        
        updates.forEach(update => {
          update.ids.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.textContent = update.value;
          });
        });
        
        // Games this week
        const gamesEl = document.getElementById('hubGames');
        if (gamesEl) {
          const scheduleWeeks = L.schedule?.weeks || L.schedule || [];
          const currentWeek = scheduleWeeks[L.week - 1];
          gamesEl.textContent = currentWeek?.games?.length || '0';
        }
        
        // Power rankings
        const powerEl = document.getElementById('hubPower');
        if (powerEl && L.teams) {
          const sorted = [...L.teams].sort((a, b) => {
            const aWins = a.record?.w || 0;
            const bWins = b.record?.w || 0;
            if (aWins !== bWins) return bWins - aWins;
            
            const aDiff = (a.record?.pf || 0) - (a.record?.pa || 0);
            const bDiff = (b.record?.pf || 0) - (b.record?.pa || 0);
            return bDiff - aDiff;
          });
          
          powerEl.innerHTML = sorted.slice(0, 10).map((team, i) => {
            const wins = team.record?.w || 0;
            const losses = team.record?.l || 0;
            const ties = team.record?.t || 0;
            return `<li>${i + 1}. ${team.name} (${wins}-${losses}${ties ? `-${ties}` : ''})</li>`;
          }).join('');
        }
        
        // Last week results
        const resultsEl = document.getElementById('hubResults');
        if (resultsEl && L.resultsByWeek) {
          const lastWeek = Math.max(0, L.week - 2);
          const results = L.resultsByWeek[lastWeek] || [];
          
          if (results.length > 0) {
            resultsEl.innerHTML = results.slice(0, 6).map(result => {
              if (result.bye !== undefined) {
                const team = L.teams[result.bye];
                return `<div class="result-item">${team?.name || 'Team'} - BYE</div>`;
              }
              
              const home = L.teams[result.home];
              const away = L.teams[result.away];
              if (!home || !away) return '';
              
              return `<div class="result-item">${away.abbr} ${result.scoreAway} @ ${home.abbr} ${result.scoreHome}</div>`;
            }).join('');
          } else {
            resultsEl.innerHTML = '<div class="muted">No recent results</div>';
          }
        }
        
      } catch (error) {
        console.error('Error in renderFixedHub:', error);
      }
    }
    
    // Fix 4: Working renderRoster
    function renderFixedRoster() {
      console.log('Rendering fixed roster...');
      
      try {
        const L = state.league;
        if (!L) return;
        
        // Set up team selection
        const teamSelect = document.getElementById('rosterTeam');
        if (teamSelect && window.fillTeamSelect) {
          if (teamSelect.options.length === 0) {
            window.fillTeamSelect(teamSelect);
          }
        }
        
        const teamId = parseInt(teamSelect?.value || state.userTeamId || '0', 10);
        const team = L.teams[teamId];
        
        if (!team) {
          console.error('No team found for roster');
          return;
        }
        
        // Update title
        const titleEl = document.getElementById('rosterTitle');
        if (titleEl) {
          titleEl.textContent = `${team.name} Roster`;
        }
        
        // Render table
        const table = document.getElementById('rosterTable');
        if (table) {
          if (!team.roster || team.roster.length === 0) {
            table.innerHTML = '<tr><td colspan="7">No players on roster</td></tr>';
            return;
          }
          
          table.innerHTML = `
            <thead>
              <tr>
                <th><input type="checkbox" id="selectAll"></th>
                <th>Name</th>
                <th>Pos</th>
                <th>Age</th>
                <th>OVR</th>
                <th>Contract</th>
                <th>Cap Hit</th>
              </tr>
            </thead>
            <tbody>
              ${team.roster.map(player => {
                const capHit = window.capHitFor ? window.capHitFor(player, 0) : player.baseAnnual || 0;
                const contract = `${player.years || 0}yr / $${(player.baseAnnual || 0).toFixed(1)}M`;
                
                return `
                  <tr>
                    <td><input type="checkbox" name="playerSelect" value="${player.id}"></td>
                    <td>${player.name}</td>
                    <td>${player.pos}</td>
                    <td>${player.age}</td>
                    <td>${player.ovr}</td>
                    <td>${contract}</td>
                    <td>$${capHit.toFixed(1)}M</td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          `;
        }
        
      } catch (error) {
        console.error('Error in renderFixedRoster:', error);
      }
    }
    
    // Fix 5: Working renderStandings
    function renderFixedStandings() {
      console.log('Rendering fixed standings...');
      
      try {
        const L = state.league;
        if (!L || !L.teams) return;
        
        const container = document.getElementById('standingsWrap');
        if (!container) return;
        
        const divNames = ['East', 'North', 'South', 'West'];
        const confNames = ['AFC', 'NFC'];
        
        let html = '';
        
        confNames.forEach((confName, confIndex) => {
          html += `<div class="conference"><h3>${confName}</h3><div class="divisions">`;
          
          divNames.forEach((divName, divIndex) => {
            const divTeams = L.teams.filter(t => t.conf === confIndex && t.div === divIndex);
            
            divTeams.sort((a, b) => {
              const aWins = a.record?.w || 0;
              const bWins = b.record?.w || 0;
              if (aWins !== bWins) return bWins - aWins;
              
              const aDiff = (a.record?.pf || 0) - (a.record?.pa || 0);
              const bDiff = (b.record?.pf || 0) - (b.record?.pa || 0);
              return bDiff - aDiff;
            });
            
            html += `
              <div class="division">
                <h4>${divName}</h4>
                <table class="table">
                  <thead>
                    <tr><th>Team</th><th>W</th><th>L</th><th>T</th><th>PF</th><th>PA</th></tr>
                  </thead>
                  <tbody>
                    ${divTeams.map(team => {
                      const wins = team.record?.w || 0;
                      const losses = team.record?.l || 0;
                      const ties = team.record?.t || 0;
                      const pf = team.record?.pf || 0;
                      const pa = team.record?.pa || 0;
                      
                      const isUser = team.id === (state.userTeamId || 0);
                      
                      return `
                        <tr${isUser ? ' class="user-team"' : ''}>
                          <td>${team.name}${isUser ? ' (You)' : ''}</td>
                          <td>${wins}</td>
                          <td>${losses}</td>
                          <td>${ties}</td>
                          <td>${pf}</td>
                          <td>${pa}</td>
                        </tr>
                      `;
                    }).join('')}
                  </tbody>
                </table>
              </div>
            `;
          });
          
          html += '</div></div>';
        });
        
        container.innerHTML = html;
        
      } catch (error) {
        console.error('Error in renderFixedStandings:', error);
      }
    }
    
    // Fix 6: Working renderDraft
    function renderFixedDraft() {
      console.log('Rendering fixed draft...');
      
      try {
        const L = state.league;
        if (!L) return;
        
        // Ensure draft class exists
        if (!state.draftClass || state.draftClass.length === 0) {
          state.draftClass = window.generateProspects ? window.generateProspects(L.year + 1) : [];
        }
        
        // Update year
        const yearEl = document.getElementById('draftYear');
        if (yearEl) yearEl.textContent = L.year + 1;
        
        // Set up team selector
        const teamSelect = document.getElementById('draftTeam');
        if (teamSelect && window.fillTeamSelect) {
          if (teamSelect.options.length === 0) {
            window.fillTeamSelect(teamSelect);
          }
        }
        
        // Render prospects
        const listEl = document.getElementById('scoutingList');
        if (listEl && state.draftClass) {
          if (state.draftClass.length === 0) {
            listEl.innerHTML = '<div class="card"><p>Draft class not yet generated</p></div>';
            return;
          }
          
          const topProspects = state.draftClass.slice(0, 20);
          listEl.innerHTML = topProspects.map((prospect, i) => `
            <div class="card prospect-card">
              <h4>#${i + 1} ${prospect.name}</h4>
              <div class="prospect-details">
                <span class="pos">${prospect.pos}</span>
                <span class="college">${prospect.college || 'Unknown College'}</span>
                <span class="age">Age ${prospect.age}</span>
                <span class="ovr">OVR ${prospect.ovr}</span>
                <span class="round">Projected: Round ${prospect.projectedRound || '?'}</span>
              </div>
              <div class="prospect-actions">
                <button class="btn ${prospect.scouted ? 'disabled' : 'primary'}" 
                        onclick="scoutPlayer('${prospect.id}')">
                  ${prospect.scouted ? 'Scouted' : 'Scout'}
                </button>
              </div>
            </div>
          `).join('');
        }
        
      } catch (error) {
        console.error('Error in renderFixedDraft:', error);
      }
    }
    
    // Fix 7: Working renderTrade
    function renderFixedTrade() {
      console.log('Rendering fixed trade...');
      
      const tradeView = document.getElementById('trade');
      if (!tradeView) return;
      
      // Set up team selectors
      ['tradeA', 'tradeB'].forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select && window.fillTeamSelect) {
          if (select.options.length === 0) {
            window.fillTeamSelect(select);
          }
        }
      });
      
      console.log('✅ Trade view setup complete');
    }
    
    // Fix 8: Scout player function
    window.scoutPlayer = function(prospectId) {
      const prospect = state.draftClass?.find(p => p.id === prospectId);
      if (!prospect) return;
      
      if (prospect.scouted) {
        window.setStatus('Player already scouted');
        return;
      }
      
      prospect.scouted = true;
      window.setStatus(`Scouted ${prospect.name} - solid prospect`);
      
      // Re-render
      renderFixedDraft();
    };
    
    // Fix 9: Set up navigation event listeners
    function setupNavigation() {
      console.log('🧭 Setting up navigation...');
      
      // Remove any existing listeners
      window.removeEventListener('hashchange', window.router);
      
      // Add hash change listener
      window.addEventListener('hashchange', window.router);
      
      // Handle nav clicks
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('nav-pill')) {
          e.preventDefault();
          const href = e.target.getAttribute('href');
          if (href && href.startsWith('#/')) {
            window.location.hash = href;
          }
        }
      });
      
      // Initial route
      setTimeout(() => {
        window.router();
      }, 100);
    }
    
    // Fix 10: Add missing CSS
    const fixCSS = `
      .user-team {
        background: rgba(10, 132, 255, 0.1) !important;
        border-left: 3px solid var(--accent, #0A84FF) !important;
      }
      
      .conference {
        margin-bottom: 2rem;
      }
      
      .conference h3 {
        color: var(--text, #E6EDF3);
        margin-bottom: 1rem;
      }
      
      .divisions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
      }
      
      .division {
        background: var(--surface, rgba(22, 27, 34, 0.75));
        border-radius: var(--radius-lg, 16px);
        padding: 1rem;
        border: 1px solid var(--hairline, rgba(255, 255, 255, 0.08));
      }
      
      .division h4 {
        color: var(--text-muted, #9FB0C2);
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
        text-transform: uppercase;
      }
      
      .prospect-card {
        border-left: 3px solid var(--accent, #0A84FF);
        margin-bottom: 1rem;
      }
      
      .prospect-details {
        display: flex;
        gap: 1rem;
        margin: 0.5rem 0;
        font-size: 0.875rem;
        color: var(--text-muted, #9FB0C2);
      }
      
      .prospect-details .pos {
        background: var(--accent, #0A84FF);
        color: white;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-weight: 600;
      }
      
      .prospect-actions {
        margin-top: 1rem;
      }
      
      .result-item {
        padding: 0.5rem;
        background: var(--surface, rgba(22, 27, 34, 0.75));
        border-radius: 8px;
        margin-bottom: 0.25rem;
        font-family: monospace;
      }
      
      .disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      
      .nav-pill[aria-current="page"] {
        background: var(--accent, #0A84FF);
        color: white;
      }
      
      @media (max-width: 768px) {
        .divisions {
          grid-template-columns: 1fr;
        }
        
        .prospect-details {
          flex-wrap: wrap;
        }
      }
    `;
    
    const styleEl = document.createElement('style');
    styleEl.textContent = fixCSS;
    document.head.appendChild(styleEl);
    
    // Apply all fixes
    setupNavigation();
    
    console.log('✅ Navigation fix complete!');
    console.log('💡 Try clicking the navigation buttons now');
  }
  
  // Auto-apply fixes when ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', applyNavigationFix);
  } else {
    applyNavigationFix();
  }
  
  // Manual fix function for console
  window.fixNavigation = applyNavigationFix;
  
})();
// bootstrap-fix.js - Add this script AFTER all other scripts in index.html
(function() {
  'use strict';
  
  console.log('🚀 NFL GM Bootstrap Fix starting...');
  
  // Wait for DOM to be fully ready
  function waitForDOM() {
    return new Promise((resolve) => {
      if (document.readyState === 'complete') {
        resolve();
      } else {
        window.addEventListener('load', resolve);
      }
    });
  }
  
  // Wait for critical objects to be available
  function waitForDependencies() {
    return new Promise((resolve) => {
      let attempts = 0;
      const maxAttempts = 50; // 5 seconds max
      
      const checkDeps = () => {
        attempts++;
        
        const required = {
          Constants: window.Constants,
          Teams: window.Teams,
          Utils: window.Utils,
          State: window.State,
          state: window.state
        };
        
        const missing = Object.keys(required).filter(key => !required[key]);
        
        if (missing.length === 0) {
          console.log('✅ All dependencies loaded');
          resolve();
        } else if (attempts >= maxAttempts) {
          console.error('❌ Timeout waiting for dependencies:', missing);
          resolve(); // Continue anyway
        } else {
          console.log(`⏳ Waiting for dependencies (${attempts}/${maxAttempts}):`, missing);
          setTimeout(checkDeps, 100);
        }
      };
      
      checkDeps();
    });
  }
  
  // Main bootstrap function
  async function bootstrap() {
    try {
      console.log('⏳ Waiting for DOM and dependencies...');
      
      // Wait for DOM
      await waitForDOM();
      console.log('✅ DOM ready');
      
      // Wait for dependencies
      await waitForDependencies();
      
      // Ensure state exists
      if (!window.state) {
        console.log('🔧 Creating missing state...');
        window.state = {
          league: null,
          freeAgents: [],
          playoffs: null,
          namesMode: 'fictional',
          onboarded: false,
          userTeamId: 0,
          gameMode: 'gm',
          playerRole: 'GM',
          player: { teamId: 0 }
        };
      }
      
      // Ensure show function exists
      if (!window.show) {
        console.log('🔧 Creating missing show function...');
        window.show = function(elementId) {
          const element = document.getElementById(elementId);
          if (element) {
            if (element.classList.contains('modal')) {
              element.style.display = 'flex';
            } else {
              element.style.display = 'block';
            }
            element.hidden = false;
          }
        };
      }
      
      // Test team selection
      console.log('🧪 Testing team selection...');
      const fictional = window.listByMode('fictional');
      const real = window.listByMode('real');
      
      if (fictional.length === 0 || real.length === 0) {
        console.error('❌ No teams found!');
        return;
      }
      
      console.log('✅ Teams available - Real:', real.length, 'Fictional:', fictional.length);
      
      // Check if modal exists
      const modal = document.getElementById('onboardModal');
      const teamSelect = document.getElementById('onboardTeam');
      
      if (!modal || !teamSelect) {
        console.error('❌ Modal elements missing');
        console.log('Modal found:', !!modal);
        console.log('Team select found:', !!teamSelect);
        return;
      }
      
      console.log('✅ Modal elements found');
      
      // Set up the onboarding system
      if (window.populateTeamDropdown) {
        window.populateTeamDropdown('fictional');
        console.log('✅ Team dropdown populated with', teamSelect.options.length, 'options');
      }
      
      // Check if we need to show onboarding
      if (!state.onboarded || !state.league) {
        console.log('🎯 Opening onboarding modal...');
        if (window.openOnboard) {
          window.openOnboard();
        } else {
          // Manual modal opening
          modal.hidden = false;
          modal.style.display = 'flex';
        }
      } else {
        console.log('🎮 Game already initialized');
        // Initialize main game
        if (window.init) {
          window.init();
        }
      }
      
      // Set up event listeners if not already done
      if (window.setupEventListeners && !document.body.hasAttribute('data-events-setup')) {
        window.setupEventListeners();
        document.body.setAttribute('data-events-setup', 'true');
      }
      
      console.log('🎉 Bootstrap completed successfully!');
      
    } catch (error) {
      console.error('💥 Bootstrap failed:', error);
      
      // Emergency fallback
      window.emergencyFix = function() {
        const modal = document.getElementById('onboardModal');
        const teamSelect = document.getElementById('onboardTeam');
        
        if (modal && teamSelect) {
          modal.hidden = false;
          modal.style.display = 'flex';
          
          if (window.listByMode) {
            const teams = window.listByMode('fictional');
            teamSelect.innerHTML = '';
            teams.forEach((team, index) => {
              const option = document.createElement('option');
              option.value = String(index);
              option.textContent = team.abbr + ' — ' + team.name;
              teamSelect.appendChild(option);
            });
            console.log('🚑 Emergency fix applied');
          }
        }
      };
      
      console.log('💡 Try running: window.emergencyFix()');
    }
  }
  
  // Start bootstrap
  bootstrap();
  
})();
</script>

</body>
</html>
